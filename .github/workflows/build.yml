# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [master, develop, 'feat/**']
    paths-ignore: ['docs/**']
  pull_request:
    branches: [master]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [14.x]

    steps:
      - uses: actions/checkout@v2
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v1
        with:
          node-version: ${{ matrix.node-version }}

      - name: Install Dependencies
        run: npm i

      - name: Lint Check
        run: npm run lint

      - name: Build Wechat App
        run: npm run build

      # ‰ªé secrets.UPLOAD_PRIVATE_KEY ÁîüÊàêÁßÅÈí•Êñá‰ª∂
      # see Project/Settings/Secrets
      - name: Generate private key for upload
        run: echo "$UPLOAD_PRIVATE_KEY" > private.key
        env:
          UPLOAD_PRIVATE_KEY: ${{ secrets.UPLOAD_PRIVATE_KEY }}
      
      # ‰∏ä‰º†‰ª£Á†Å
      - name: Login to tcb
        run: npx tcb login --apiKeyId $TCB_API_KEY_ID --apiKey $TCB_API_KEY
        env:
          TCB_API_KEY_ID: ${{ secrets.TCB_API_KEY_ID }} 
          TCB_API_KEY: ${{ secrets.TCB_API_KEY }}
      
      - name: Deploy
        run: npm run deploy

      - name: Upload Artifacts üöÄ
        uses: actions/upload-artifact@v2
        with:
          name: qrcode
          path: qrcode.jpg
